function setRealContentHeight(){var e=$.mobile.activePage.find("div[data-role='header']:visible"),i=$.mobile.activePage.find("div[data-role='footer']:visible"),t=$.mobile.activePage.find("div.ui-content:visible:visible"),n=$(window).height(),a=n-(e.outerHeight()-1)-(i.outerHeight()-1);t.outerHeight()-e.outerHeight()-i.outerHeight()<=n&&(a-=t.outerHeight()-t.height()),$(".ui-content").height(a)}function get_rss(e,i){var t="",n="",a=[],o=[],r=0,c="",h="",m=[];$.get(e,function(e){$(e).find("item").each(function(){var e=$(this);t=e.find("title").text().replace("<![CDATA[","").replace("]]>","").split(" | "),n=t[0].trim(),-1==a.indexOf(n)&&(r=a.push(n)-1,o[r]=[]),c=e.find("description").text().replace("<![CDATA[","").replace("]]>",""),h=e.find("comments").text().replace("<![CDATA[","").replace("]]>",""),o[r].push({heure:t[1],titre:t[2],description:c,commentaires:h})}),$.each(a,function(e,i){m.push({nom:i,programme:o[e]})}),i(m)})}function affiche_chaines(e,i){return 0==i.length?!1:($.each(e,function(e,t){i.append("<li><a href='#' data-chaineindex='"+e+"' class='chaine'>"+t.nom+"</a></li>")}),void $("#chaines .chaine").on("click",function(i){i.stopPropagation(),i.preventDefault();var t=$(this).data("chaineindex"),n=e[t];$("#page_chaine_programme .titre_chaine").html(n.nom),$("#page_chaine_programme .programme_chaine").empty(),$.each(n.programme,function(e,i){$contenu=$('<div class="programme"><div class="ui-corner-all custom-corners"><div class="ui-bar ui-bar-a"><h3>'+i.heure+" - "+i.titre+'</h3></div><div class="ui-body ui-body-a"><p>'+i.description+"</p></div></div></div>"),$("#page_chaine_programme .programme_chaine").append($contenu)}),document.location="#page_chaine_programme"}))}function init(){$(document).on("pageshow",setRealContentHeight),$(document).on("deviceready",function(){}),$(document).on("pageshow",function(){$(".nav-menu").load("menu.html",function(){$(".nav-menu").panel(),$(".nav-menu").trigger("updatelayout")})}),$(document).on("click","button.refresh",function(){$.mobile.loading("show",{text:"Chargement du programme TV",textVisible:!0,theme:"b",textonly:!1,html:""}),get_rss(rss,function(e){var i={date:date,programme:e};localStorage.setItem("programmetv",JSON.stringify(i)),$("#chaines").empty(),affiche_chaines(i.programme,$("#chaines")),$("#chaines").listview("refresh"),$.mobile.loading("hide")})})}